(this["webpackJsonpgitlab-codereview-analyzer"]=this["webpackJsonpgitlab-codereview-analyzer"]||[]).push([[0],{342:function(e,t,n){},344:function(e,t,n){},495:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),c=n(57),i=n.n(c),o=(n(342),n(11)),u=n(28),l=n.n(u),s=n(49),j=n(8),b=(n(344),n(74));function f(e,t){var n=Object(r.useState)((function(){try{var n=window.localStorage.getItem(e);return n?JSON.parse(n):t}catch(r){return console.log(r),t}})),a=Object(j.a)(n,2),c=a[0],i=a[1];return[c,function(t){try{var n=t instanceof Function?t(c):t;i(n),window.localStorage.setItem(e,JSON.stringify(n))}catch(r){console.log(r)}}]}function d(){return(d=Object(s.a)(l.a.mark((function e(t,n){var r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.Projects.search(n);case 2:return r=e.sent,e.abrupt("return",r);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function O(e,t){return p.apply(this,arguments)}function p(){return(p=Object(s.a)(l.a.mark((function e(t,n){var r,a,c,i,o,u,s,j;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.projectId,a=n.createdAfter,c=n.createdBefore,e.next=3,t.MergeRequests.all({projectId:r,createdAfter:a,createdBefore:c,perPage:100});case 3:return i=e.sent,o=i.filter((function(e){return 0!==e.user_notes_count})),u=o.map((function(e){return t.MergeRequestDiscussions.all(r,e.iid,{perPage:100}).then((function(t){return t.filter((function(e){var t;return null===(t=e.notes)||void 0===t?void 0:t.some((function(e){return!e.system}))})).map((function(t){return{mergeRequest:e,discussion:t}}))}))})),e.next=8,Promise.allSettled(u);case 8:return s=e.sent,j=s.flatMap((function(e){return"fulfilled"===e.status?e.value:[]})),e.abrupt("return",j);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e,t){return v.apply(this,arguments)}function v(){return(v=Object(s.a)(l.a.mark((function e(t,n){var r,a,c,i,o,u,s,j;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.projectId,a=n.createdAfter,c=n.createdBefore,e.next=3,t.MergeRequests.all({projectId:r,createdAfter:a,createdBefore:c,perPage:100});case 3:return i=e.sent,o=i.filter((function(e){return 0!==e.user_notes_count})),u=o.map((function(e){return t.MergeRequestNotes.all(r,e.iid,{perPage:100}).then((function(t){return t.filter((function(e){return!e.system})).map((function(t){return{mergeRequest:e,comment:t}}))}))})),e.next=8,Promise.allSettled(u);case 8:return s=e.sent,j=s.flatMap((function(e){return"fulfilled"===e.status?e.value:[]})),e.abrupt("return",j);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){var t=e.mergeRequest,n=e.comment;return"".concat(t.web_url,"/#note_").concat(n.id)}var x=n(588),g=n(590),y=n(576),w=n(597),S=n(593),k=n(577),C=n(587),I=n(1);function M(e){var t=e.user,n=e.label,a=e.onUserSelected,c=f("credentials",null),i=Object(j.a)(c,1)[0],u=Object(r.useMemo)((function(){return new b.Gitlab(i)}),[i]),l=Object(r.useState)([]),s=Object(j.a)(l,2),d=s[0],O=s[1];return Object(r.useEffect)((function(){u.Users.all({perPage:100}).then((function(e){O(e)}))}),[u]),Object(I.jsx)(x.a,{value:t,options:d,getOptionLabel:function(e){return e.name},onChange:function(e,t){return a(t)},renderOption:function(e,n){return Object(I.jsx)(g.a,Object(o.a)(Object(o.a)({alignItems:"flex-start",disabled:"blocked"===n.state},e),{},{children:Object(I.jsxs)(y.a,{selected:(null===t||void 0===t?void 0:t.id)===n.id,children:[Object(I.jsx)(w.a,{children:Object(I.jsx)(S.a,{alt:n.name,src:n.avatar_url})}),Object(I.jsx)(k.a,{primary:n.name,secondary:n.username})]})}),n.id)},renderInput:function(e){return Object(I.jsx)(C.a,Object(o.a)(Object(o.a)({},e),{},{label:n,variant:"outlined"}))}})}var P=n(598);function A(e){var t=e.comments;return Object(I.jsx)(P.a,{children:t.map((function(e){return Object(I.jsxs)(g.a,{children:[Object(I.jsx)(w.a,{children:Object(I.jsx)(S.a,{src:e.comment.author.avatar_url})}),Object(I.jsx)(k.a,{primary:Object(I.jsx)("a",{href:m(e),target:"_blank",rel:"noreferrer",children:e.mergeRequest.title}),secondary:e.comment.body})]},e.comment.id)}))})}var R=n(599);function E(e){var t=e.project,n=e.onProjectSelected,c=f("credentials",null),i=Object(j.a)(c,1)[0],u=Object(r.useMemo)((function(){return new b.Gitlab(i)}),[i]),l=a.a.useState(!1),s=Object(j.a)(l,2),O=s[0],p=s[1],h=a.a.useState([]),v=Object(j.a)(h,2),m=v[0],M=v[1],P=Object(r.useState)(!1),A=Object(j.a)(P,2),E=A[0],q=A[1],z=Object(r.useState)(""),B=Object(j.a)(z,2),_=B[0],D=B[1],L=function(e,t){var n=Object(r.useState)(e),a=Object(j.a)(n,2),c=a[0],i=a[1];return Object(r.useEffect)((function(){var n=setTimeout((function(){i(e)}),t);return function(){clearTimeout(n)}}),[e,t]),c}(_,300);return Object(r.useEffect)((function(){u&&O&&L&&(q(!0),function(e,t){return d.apply(this,arguments)}(u,L).then(M).finally((function(){return q(!1)})))}),[u,L,O]),Object(I.jsx)(x.a,{getOptionLabel:function(e){return e.name_with_namespace},open:O,onOpen:function(){return p(!0)},onClose:function(){return p(!1)},options:m,loading:E,value:t,onChange:function(e,t){return n(t)},onInputChange:function(e,t){return D(t)},filterOptions:function(e){return e},renderOption:function(e,n){return Object(I.jsx)(g.a,Object(o.a)(Object(o.a)({alignItems:"flex-start"},e),{},{children:Object(I.jsxs)(y.a,{selected:(null===t||void 0===t?void 0:t.id)===n.id,children:[Object(I.jsx)(w.a,{children:Object(I.jsx)(S.a,{alt:n.name,src:n.avatar_url})}),Object(I.jsx)(k.a,{primary:n.name_with_namespace,secondary:n.description})]})}),n.id)},renderInput:function(e){return Object(I.jsx)(C.a,Object(o.a)(Object(o.a)({},e),{},{label:"Projects",InputProps:Object(o.a)(Object(o.a)({},e.InputProps),{},{endAdornment:Object(I.jsxs)(a.a.Fragment,{children:[E?Object(I.jsx)(R.a,{color:"inherit",size:20}):null,e.InputProps.endAdornment]})})}))}})}var q=n(91),z=n(24);function B(e,t,n){var r="author"===t?"reviewer":"author",a=Object(z.i)(e,Object(z.d)((function(e){return e[t]===n}))),c=Object(z.i)(a,Object(z.e)([r],[Object(z.h)({total:Object(z.f)()})]),Object(z.d)((function(e){return 0!==e.total}))),i={userName:n,total:Object(z.i)(c,Object(z.h)({total:Object(z.g)("total")}))[0].total};return c.forEach((function(e){i[e[r]]=e.total})),i}function _(e){var t=Object(z.i)(e,Object(z.c)(["reviewer"])).map((function(e){return e.reviewer})),n=Object(z.i)(e,Object(z.c)(["author"])).map((function(e){return e.author})),r=t.map((function(t){return B(e,"reviewer",t)}));return{indexBy:"userName",keys:n,data:r=Object(z.i)(r,Object(z.a)([Object(z.b)("total")]))}}function D(e){var t=Object(z.i)(e,Object(z.c)(["reviewer"])).map((function(e){return e.reviewer})),n=Object(z.i)(e,Object(z.c)(["author"])).map((function(e){return e.author})).map((function(t){return B(e,"author",t)}));return{indexBy:"userName",keys:t,data:n=Object(z.i)(n,Object(z.a)([Object(z.b)("total")]))}}function L(e){return e.map((function(e){return{reviewer:e.comment.author.username,author:e.mergeRequest.author.username}}))}var F=n(584),G=n(163),N=n(594),T=n(583);function H(){return(H=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function U(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},c=Object.keys(e);for(r=0;r<c.length;r++)n=c[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(r=0;r<c.length;r++)n=c[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var W=r.createElement("path",{d:"M128.075 236.075l47.104-144.97H80.97l47.104 144.97z",fill:"#E24329"}),J=r.createElement("path",{d:"M128.075 236.074L80.97 91.104H14.956l113.119 144.97z",fill:"#FC6D26"}),V=r.createElement("path",{d:"M14.956 91.104L.642 135.16a9.752 9.752 0 0 0 3.542 10.903l123.891 90.012-113.12-144.97z",fill:"#FCA326"}),Q=r.createElement("path",{d:"M14.956 91.105H80.97L52.601 3.79c-1.46-4.493-7.816-4.492-9.275 0l-28.37 87.315z",fill:"#E24329"}),Y=r.createElement("path",{d:"M128.075 236.074l47.104-144.97h66.015l-113.12 144.97z",fill:"#FC6D26"}),K=r.createElement("path",{d:"M241.194 91.104l14.314 44.056a9.752 9.752 0 0 1-3.543 10.903l-123.89 90.012 113.119-144.97z",fill:"#FCA326"}),X=r.createElement("path",{d:"M241.194 91.105h-66.015l28.37-87.315c1.46-4.493 7.816-4.492 9.275 0l28.37 87.315z",fill:"#E24329"});function Z(e,t){var n=e.title,a=e.titleId,c=U(e,["title","titleId"]);return r.createElement("svg",H({viewBox:"0 0 256 236",xmlns:"http://www.w3.org/2000/svg",preserveAspectRatio:"xMinYMin meet",ref:t,"aria-labelledby":a},c),n?r.createElement("title",{id:a},n):null,W,J,V,Q,Y,K,X)}var $=r.forwardRef(Z);n.p;function ee(e){var t=e.onLoggedIn,n=Object(r.useState)(""),a=Object(j.a)(n,2),c=a[0],i=a[1],o=Object(r.useState)(""),u=Object(j.a)(o,2),l=u[0],s=u[1],f=Object(r.useCallback)((function(){new b.Gitlab({token:c,host:l}).Users.current().then((function(e){t(c,l,e)})).catch((function(e){console.log(e)}))}),[l,t,c]);return Object(I.jsx)(T.a,{style:{width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center"},children:Object(I.jsxs)(F.a,{style:{width:500},spacing:2,children:[Object(I.jsx)($,{style:{width:150,alignSelf:"center"}}),Object(I.jsx)(G.a,{variant:"h5",component:"h1",alignSelf:"center",children:"GitLab Code Review Analyzer"}),Object(I.jsx)(C.a,{required:!0,label:"Host",name:"host",placeholder:"https://gitlab.com",value:l,onChange:function(e){return s(e.target.value)}}),Object(I.jsx)(C.a,{required:!0,label:"Token",name:"token",value:c,type:"password",onChange:function(e){return i(e.target.value)}}),Object(I.jsx)(N.a,{onClick:f,children:"Sing In"})]})})}var te=n(600),ne=n(601),re=n(602),ae=n(585),ce=n(591),ie=n(595),oe=n(311),ue=n(592),le=n(20),se=n(307);var je=n(596);function be(e){var t=e.children,n=e.title;return Object(I.jsxs)(je.a,{variant:"outlined",square:!0,component:"section",children:[Object(I.jsx)("h3",{children:n}),t]})}var fe={width:500,height:400,margin:{left:150},padding:.2,labelTextColor:"inherit:darker(1.4)",labelSkipWidth:16,labelSkipHeight:16,layout:"horizontal"};var de=function(){var e=f("credentials",null),t=Object(j.a)(e,2),n=t[0],c=t[1],i=f("user",null),u=Object(j.a)(i,2),d=u[0],p=u[1],v=f("project",null),x=Object(j.a)(v,2),g=x[0],y=x[1],w=Object(r.useState)([]),k=Object(j.a)(w,2),P=k[0],R=k[1],B=Object(r.useState)([]),T=Object(j.a)(B,2),H=T[0],U=T[1],W=Object(r.useState)(new Date),J=Object(j.a)(W,2),V=J[0],Q=J[1],Y=Object(r.useState)(new Date((new Date).setMonth((new Date).getMonth()-1))),K=Object(j.a)(Y,2),X=K[0],Z=K[1],$=Object(r.useState)(null),je=Object(j.a)($,2),de=je[0],Oe=je[1],pe=Object(r.useState)([]),he=Object(j.a)(pe,2),ve=he[0],me=he[1],xe=Object(r.useMemo)((function(){return new b.Gitlab(n)}),[n]);Object(r.useEffect)((function(){xe.Users.current().then((function(e){Oe(e)}))}),[xe]);var ge=function(){var e=Object(s.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,g){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,h(xe,{projectId:g.id,createdAfter:X.toISOString(),createdBefore:V.toISOString()});case 5:t=e.sent,R(t),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.error(e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}}(),ye=function(){var e=Object(s.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,g){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,O(xe,{projectId:g.id,createdAfter:X.toISOString(),createdBefore:V.toISOString()});case 5:t=e.sent,U(t),console.log(t),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),console.error(e.t0);case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(){return e.apply(this,arguments)}}(),we=Object(r.useMemo)((function(){return function(e){return _(e.map((function(e){var t,n,r,a;return{author:e.mergeRequest.author.username,reviewer:null!==(t=null===(n=e.discussion)||void 0===n||null===(r=n.notes)||void 0===r||null===(a=r[0])||void 0===a?void 0:a.author.username)&&void 0!==t?t:"[empty]"}})).filter((function(e){return e.reviewer!==e.author})))}(H)}),[H]),Se=Object(r.useMemo)((function(){return function(e){return D(e.map((function(e){var t,n,r,a;return{author:e.mergeRequest.author.username,reviewer:null!==(t=null===(n=e.discussion)||void 0===n||null===(r=n.notes)||void 0===r||null===(a=r[0])||void 0===a?void 0:a.author.username)&&void 0!==t?t:"[empty]"}})).filter((function(e){return e.reviewer!==e.author})))}(H)}),[H]),ke=Object(r.useMemo)((function(){return function(e){return _(L(e).filter((function(e){return e.reviewer!==e.author})))}(P)}),[P]),Ce=Object(r.useMemo)((function(){return function(e){return D(L(e).filter((function(e){return e.reviewer!==e.author})))}(P)}),[P]),Ie=Object(r.useMemo)((function(){return d?function(e,t){var n=L(e.filter((function(e){return e.mergeRequest.author.id===t}))).filter((function(e){return e.reviewer!==e.author}));return{indexBy:"reviewer",keys:["total"],data:Object(z.i)(n,Object(z.e)("reviewer",[Object(z.h)({total:Object(z.f)()})]),Object(z.a)([Object(z.b)("total")]))}}(P,d.id):null}),[P,d]),Me=Object(r.useMemo)((function(){return d?function(e,t){var n=L(e.filter((function(e){return e.comment.author.id===t}))).filter((function(e){return e.author!==e.reviewer}));return{indexBy:"author",keys:["total"],data:Object(z.i)(n,Object(z.e)("author",[Object(z.h)({total:Object(z.f)()})]),Object(z.a)([Object(z.b)("total")]))}}(P,d.id):null}),[P,d]),Pe=Object(r.useCallback)((function(e,t){me(function(e,t,n){var r=e;return t&&(r=r.filter((function(e){return e.comment.author.username===t}))),n&&(r=r.filter((function(e){return e.mergeRequest.author.username===n}))),r}(P,e,t))}),[P]),Ae=a.a.useState(null),Re=Object(j.a)(Ae,2),Ee=Re[0],qe=Re[1],ze=function(){qe(null)};return n?Object(I.jsxs)("div",{className:"App",children:[Object(I.jsx)(te.a,{position:"static",children:Object(I.jsx)(ne.a,{maxWidth:"xl",children:Object(I.jsxs)(re.a,{disableGutters:!0,children:[Object(I.jsx)(G.a,{variant:"h6",noWrap:!0,component:"div",sx:{mr:2,display:"flex",flexGrow:1},children:"Analyzer"}),Object(I.jsxs)(ae.a,{sx:{flexGrow:0},children:[Object(I.jsx)(ce.a,{title:"Open settings",children:Object(I.jsx)(ie.a,{onClick:function(e){qe(e.currentTarget)},sx:{p:0},children:Object(I.jsx)(S.a,{alt:null===de||void 0===de?void 0:de.name,src:null===de||void 0===de?void 0:de.avatar_url})})}),Object(I.jsx)(oe.a,{sx:{mt:"45px"},id:"menu-appbar",anchorEl:Ee,anchorOrigin:{vertical:"top",horizontal:"right"},keepMounted:!0,transformOrigin:{vertical:"top",horizontal:"right"},open:Boolean(Ee),onClose:ze,children:Object(I.jsx)(ue.a,{onClick:function(){c(null),ze()},children:Object(I.jsx)(G.a,{textAlign:"center",children:"Logout"})})})]})]})})}),Object(I.jsxs)(ae.a,{style:{display:"flex"},children:[Object(I.jsxs)(F.a,{className:"App-users",spacing:2,children:[Object(I.jsx)(E,{project:g,onProjectSelected:y}),Object(I.jsx)(M,{label:"Author",user:d,onUserSelected:p}),Object(I.jsx)(C.a,{label:"Created After",type:"date",value:null===X||void 0===X?void 0:X.toISOString().substring(0,10),onChange:function(e){var t=new Date(e.target.value);Z(t)},InputLabelProps:{shrink:!0},fullWidth:!0}),Object(I.jsx)(C.a,{label:"Created Before",type:"date",value:null===V||void 0===V?void 0:V.toISOString().substring(0,10),onChange:function(e){var t=new Date(e.target.value);Q(t)},InputLabelProps:{shrink:!0},fullWidth:!0}),Object(I.jsx)(N.a,{onClick:function(){Promise.all([ge(),ye()])},children:"Analyze"}),Object(I.jsx)(N.a,{onClick:function(){!function(e){var t=e.map((function(e){var t=e.mergeRequest,n=e.comment;return[{value:t.author.username,type:"string"},{value:n.author.username,type:"string"},{value:n.body,type:"string"},{value:m({mergeRequest:t,comment:n}),type:"string"},{value:t.title,type:"string"}]})),n={filename:"general-ledger-Q1",sheet:{data:[[{value:"MR Author",type:"string"},{value:"Comment Author - Reviewer",type:"string"},{value:"Comment Content",type:"string"},{value:"Comment Link",type:"string"},{value:"MR Title",type:"string"}]].concat(Object(le.a)(t))}};Object(se.a)(n)}(ve)},children:"Download"})]}),Object(I.jsxs)("div",{style:{display:"flex",flexDirection:"column",flexGrow:1},children:[Object(I.jsxs)("div",{className:"charts",children:[d&&Me&&Object(I.jsx)(be,{title:"".concat(null===d||void 0===d?void 0:d.name," reviews following people"),children:Object(I.jsx)(q.a,Object(o.a)(Object(o.a)(Object(o.a)({},fe),Me),{},{onClick:function(e){Pe(d.username,e.data.author)}}))}),d&&Ie&&Object(I.jsx)(be,{title:"Following people review ".concat(null===d||void 0===d?void 0:d.name),children:Object(I.jsx)(q.a,Object(o.a)(Object(o.a)(Object(o.a)({},fe),Ie),{},{onClick:function(e){Pe(e.data.reviewer,d.username)}}))}),Object(I.jsx)(be,{title:"Comments left by person",children:Object(I.jsx)(q.a,Object(o.a)(Object(o.a)(Object(o.a)({},fe),ke),{},{onClick:function(e){Pe(e.indexValue,e.id)}}))}),Object(I.jsx)(be,{title:"Comments recieved by person",children:Object(I.jsx)(q.a,Object(o.a)(Object(o.a)(Object(o.a)({},fe),Ce),{},{onClick:function(e){Pe(e.id,e.indexValue)}}))}),Object(I.jsx)(be,{title:"Discussions left by person",children:Object(I.jsx)(q.a,Object(o.a)(Object(o.a)(Object(o.a)({},fe),we),{},{onClick:function(e){console.log(e)}}))}),Object(I.jsx)(be,{title:"Discussions received by person",children:Object(I.jsx)(q.a,Object(o.a)(Object(o.a)(Object(o.a)({},fe),Se),{},{onClick:function(e){console.log(e)}}))})]}),Object(I.jsx)(A,{comments:ve}),"Total: ",ve.length]})]})]}):Object(I.jsx)(ee,{onLoggedIn:function(e,t,n){c({token:e,host:t}),Oe(n)}})},Oe=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,603)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,c=t.getLCP,i=t.getTTFB;n(e),r(e),a(e),c(e),i(e)}))};i.a.render(Object(I.jsx)(a.a.StrictMode,{children:Object(I.jsx)(de,{})}),document.getElementById("root")),Oe()}},[[495,1,2]]]);
//# sourceMappingURL=main.4fd03044.chunk.js.map